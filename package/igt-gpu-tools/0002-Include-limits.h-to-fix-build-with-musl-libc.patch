From fea7a3189a6e42bb625c3742828849d6360f1435 Mon Sep 17 00:00:00 2001
From: Stefano Ragni <st3r4g@protonmail.com>
Date: Sun, 22 Oct 2023 11:47:39 +0200
Subject: [PATCH] Include limits.h to fix build with musl libc

Original patch was added to void-linux:
https://github.com/void-linux/void-packages/commit/ddfc1f66a0c571b420303c33aed29fd38ace4fc7

Bug report with request to split the original patch into some
functional changes:
Link: https://gitlab.freedesktop.org/drm/igt-gpu-tools/-/issues/138

Upstream: https://lists.freedesktop.org/archives/igt-dev/2023-October/063815.html

Signed-off-by: Stefano Ragni <st3r4g@protonmail.com>
Signed-off-by: Bernd Kuhls <bernd@kuhls.net>
[Bernd: alphabetically sorted includes, removed includes not needed
 anymore, backported to v1.28]
---
 lib/igt_aux.c                 | 1 +
 lib/igt_eld.c                 | 1 +
 lib/igt_hwmon.c               | 1 +
 tests/intel/i915_pm_rpm.c     | 1 +
 tests/kms_sysfs_edid_timing.c | 1 +
 5 files changed, 5 insertions(+)

diff --git a/lib/igt_aux.c b/lib/igt_aux.c
index 18edc5ef9..d6aeb876b 100644
--- a/lib/igt_aux.c
+++ b/lib/igt_aux.c
@@ -31,6 +31,7 @@
 #endif
 #include <stdio.h>
 #include <fcntl.h>
+#include <limits.h> // PATH_MAX
 #include <pwd.h>
 #include <sys/stat.h>
 #include <sys/ioctl.h>
diff --git a/lib/igt_eld.c b/lib/igt_eld.c
index ef6625df1..6cec9abdd 100644
--- a/lib/igt_eld.c
+++ b/lib/igt_eld.c
@@ -28,6 +28,7 @@
 #include <dirent.h>
 #include <errno.h>
 #include <glob.h>
+#include <limits.h> // PATH_MAX
 #include <stdint.h>
 #include <stdio.h>
 #include <string.h>
diff --git a/lib/igt_hwmon.c b/lib/igt_hwmon.c
index 309019d69..6216a1607 100644
--- a/lib/igt_hwmon.c
+++ b/lib/igt_hwmon.c
@@ -2,6 +2,7 @@
 /*
  * Copyright Â© 2022 Intel Corporation
  */
+#include <limits.h> // PATH_MAX
 #include <sys/stat.h>
 #include <sys/sysmacros.h>
 #include <dirent.h>
diff --git a/tests/intel/i915_pm_rpm.c b/tests/intel/i915_pm_rpm.c
index 17413ffe5..bf0ab4ae7 100644
--- a/tests/intel/i915_pm_rpm.c
+++ b/tests/intel/i915_pm_rpm.c
@@ -35,6 +35,7 @@
 
 #include <unistd.h>
 #include <fcntl.h>
+#include <limits.h> // PATH_MAX
 #include <dirent.h>
 #include <sys/ioctl.h>
 #include <sys/mman.h>
diff --git a/tests/kms_sysfs_edid_timing.c b/tests/kms_sysfs_edid_timing.c
index ee47a024e..c371a5e5e 100644
--- a/tests/kms_sysfs_edid_timing.c
+++ b/tests/kms_sysfs_edid_timing.c
@@ -24,6 +24,7 @@
 
 #include <dirent.h>
 #include <fcntl.h>
+#include <limits.h> // PATH_MAX
 #include <sys/stat.h>
 /**
  * TEST: kms sysfs edid timing
-- 
2.39.2

